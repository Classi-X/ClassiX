{% extends "base.html" %}

{% block title %}Student Dashboard | ClassiX | AI Attendance Management for Schools & Colleges{% endblock %}

{% block content %}
<div class="container-fluid">
  <div class="row">
    <div
      class="d-md-none bg-gradient bg-primary text-white d-flex justify-content-between align-items-center px-4 py-3 shadow-sm rounded-bottom animate__animated animate__fadeInDown">
      <div class="d-flex align-items-center">
        <i class="fas fa-chart-line fs-4 me-2"></i>
        <h5 class="mb-0 fw-semibold">Dashboard</h5>
      </div>
      <button
        class="btn btn-light btn-sm rounded-circle shadow-sm d-flex align-items-center justify-content-center transition"
        onclick="toggleSidebar()" aria-label="Toggle Sidebar">
        <i class="fas fa-bars text-primary fs-5"></i>
      </button>
    </div>

    <style>
      .transition {
        transition: all 0.3s ease-in-out;
      }

      .btn-light:hover {
        background-color: #e2e6ea;
        transform: scale(1.05);
      }
    </style>
    <script>
      function toggleSidebar() {
        const sidebar = document.getElementById('sidebar');
        sidebar.classList.toggle('d-none');
        sidebar.classList.toggle('d-block');
      }

      document.addEventListener('DOMContentLoaded', () => {
        const blinkArea = document.getElementById('blinkArea');

        async function checkNewChats() {
          try {
            const res = await fetch('/chat/has-new');
            const data = await res.json();
            blinkArea.classList.toggle('blinking', data.new_message);
          } catch (err) {
            console.error("Error checking chat notifications", err);
          }
        }

        checkNewChats();
        setInterval(checkNewChats, 10000);
      });
    </script>


    <div id="sidebar" class="col-md-3 col-lg-2 bg-white border-end shadow-sm p-0 sidebar-collapse d-none d-md-block">
      <div class="list-group list-group-flush py-3">

        <a href="{{ url_for('student_dashboard') }}"
          class="d-none d-md-inline list-group-item list-group-item-action active d-flex align-items-center">
          <i class="fas fa-gauge-high me-2 text-primary"></i> Dashboard
        </a>

        <a href="{{ url_for('scan_qr') }}" class="list-group-item list-group-item-action d-flex align-items-center">
          <i class="fas fa-qrcode me-2 text-success"></i> Scan QR
        </a>

        <a href="{{ url_for('scan_face') }}" class="list-group-item list-group-item-action d-flex align-items-center">
          <i class="fas fa-camera me-2 me-2 text-dark"></i> Scan Face
        </a>

        <a href="{{ url_for('parent_contact') }}"
          class="list-group-item list-group-item-action d-flex align-items-center">
          <i class="fas fa-users me-2 text-secondary"></i> Parent Contact
        </a>

        <a href="{{ url_for('attendance_records') }}"
          class="list-group-item list-group-item-action d-flex align-items-center">
          <i class="fas fa-clipboard-list me-2 text-warning"></i> Attendance Records
        </a>

        <a href="{{ url_for('students_in_class') }}"
          class="list-group-item list-group-item-action d-flex align-items-center">
          <i class="fas fa-people-roof me-2 text-info"></i> Students in Class
        </a>

        <a href="{{ url_for('view_own_profile') }}"
          class="list-group-item list-group-item-action d-flex align-items-center">
          <i class="fas fa-user-circle me-2 text-primary"></i> Profile
        </a>

        <a href="{{ url_for('logout') }}" class="sidebar-link list-group-item list-group-item-action">
          <i class="fas fa-sign-out-alt me-2 text-primary"></i>Logout
        </a>

        <a href="{{ url_for('chat_history') }}"
          class="list-group-item list-group-item-action d-flex justify-content-between align-items-center position-relative"
          id="myChatsLink">
          <div class="d-flex align-items-center blink-area" id="blinkArea">
            <i class="fas fa-comments me-2 text-danger"></i>
            <span>My Chats</span>
          </div>
        </a>

        <a href="{{ url_for('about') }}" class="list-group-item list-group-item-action d-flex align-items-center">
          <i class="fas fa-circle-info me-2 text-secondary"></i> About Us
        </a>

        <a href="{{ url_for('contact') }}" class="list-group-item list-group-item-action d-flex align-items-center">
          <i class="fas fa-envelope-open-text me-2 text-success"></i> Contact
        </a>

        <a href="/chat/1" class="list-group-item list-group-item-action d-flex align-items-center">
          <i class="fas fa-user-secret me-2 text-dark"></i> Chat SuperAdmin
        </a>

        <a href="{{ url_for('terms') }}" class="list-group-item list-group-item-action d-flex align-items-center">
          <i class="fas fa-file-signature me-2 text-muted"></i> Terms & Conditions
        </a>

        <a href="{{ url_for('privacy') }}" class="list-group-item list-group-item-action d-flex align-items-center">
          <i class="fas fa-shield-alt me-2 text-info"></i> Privacy Policy
        </a>
        <a href="{{ url_for('faq') }}" class="sidebar-link list-group-item list-group-item-action">
          <i class="fas fa-question-circle me-2"></i>FAQ
        </a>
        <a href="{{ url_for('ai_chat') }}" class="sidebar-link list-group-item list-group-item-action">
          <i class="fas fa-robot me-2"></i>AI ChatBot
        </a>
        <a href="https://drive.google.com/file/d/1N-clv6CaCu54kyOuHrUz61l0DGF87gnM/view?usp=sharing" class="sidebar-link list-group-item list-group-item-action">
          <i class="fas fa-user-graduate me-2"></i>Student User Manual
        </a>

      </div>


      <style>
        .blink-area.blinking {
          color: #dc3545 !important;
          animation: blinkRed 1.2s ease-in-out infinite;
          font-weight: 600;
        }

        .blink-area.blinking i {
          color: #dc3545 !important;
        }

        @keyframes blinkRed {

          0%,
          100% {
            opacity: 1;
            text-shadow: 0 0 5px rgba(220, 53, 69, 0.6);
          }

          50% {
            opacity: 0.4;
            text-shadow: 0 0 10px rgba(220, 53, 69, 0.9);
          }
        }
      </style>


      <script>
        document.addEventListener('DOMContentLoaded', () => {
          const blinkArea = document.getElementById('blinkArea');

          async function checkNewChats() {
            try {
              const res = await fetch('/chat/has-new');
              const data = await res.json();
              blinkArea.classList.toggle('blinking', data.new_message);
            } catch (err) {
              console.error("Error checking chat notifications", err);
            }
          }

          checkNewChats();
          setInterval(checkNewChats, 10000);
        });
      </script>


      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    </div>


    <div class="col-md-9 col-lg-10">

      <div
        class="d-flex justify-content-between align-items-center pt-4 pb-3 mb-4 border-bottom border-2 border-primary-subtle animate__animated animate__fadeInDown">
        <h1 class="h3 fw-bold text-primary d-flex align-items-center">
          <i class="fas fa-user-graduate me-2"></i> Student Dashboard
        </h1>
        <div
          class="badge bg-primary-subtle text-primary border border-primary fw-semibold px-3 py-2 rounded-pill shadow-sm">
          <i class="fas fa-layer-group me-1"></i> {{ current_user.class_name or 'Class Not Set' }}
        </div>
      </div>

      <div class="modal fade" id="attendanceHelpModal" tabindex="-1" aria-labelledby="attendanceHelpLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable">
          <div class="modal-content border-0 shadow-sm">
            <div class="modal-header bg-primary text-white">
              <h5 class="modal-title" id="attendanceHelpLabel">
                <i class="fas fa-info-circle me-2"></i> Attendance Summary Guide
              </h5>
              <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <ul class="mb-3">
                <li><strong>Total Classes:</strong> Total number of classes conducted.</li>
                <li><strong>Present Days:</strong> Number of days the student was marked present.</li>
                <li><strong>Absent Days:</strong> Calculated automatically as:
                  <code>Total Classes - Present Days</code>.</li>
                <li><strong>Attendance Percentage:</strong> Calculated using:
                  <code>(Present / Total Classes) Ã— 100</code>.
                </li>
              </ul>
              <div class="alert alert-warning small">
                <i class="fas fa-exclamation-circle me-1"></i> Attendance below 75% may trigger warnings or restrictions
                as per institutional policy.
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-outline-secondary btn-sm" data-bs-dismiss="modal">
                <i class="fas fa-times me-1"></i> Close
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="row g-4">
        <div class="d-flex justify-content-end mb-2">
          <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#attendanceHelpModal">
            <i class="fas fa-circle-info me-1"></i> Instructions
          </button>
        </div>

        <div class="col-sm-6 col-lg-3">
          <div class="card shadow-sm border-0 bg-primary text-white h-100 animate__animated animate__fadeInUp">
            <div class="card-body d-flex justify-content-between align-items-center">
              <div>
                <h6 class="text-uppercase fw-semibold mb-1">Total Classes</h6>
                <h3 class="mb-0">{{ total_classes }}</h3>
              </div>
              <i class="fas fa-book fa-2x opacity-75"></i>
            </div>
          </div>
        </div>


        <div class="col-sm-6 col-lg-3">
          <div class="card shadow-sm border-0 bg-success text-white h-100 animate__animated animate__fadeInUp">
            <div class="card-body d-flex justify-content-between align-items-center">
              <div>
                <h6 class="text-uppercase fw-semibold mb-1">Present Days</h6>
                <h3 class="mb-0">{{ present_count }}</h3>
              </div>
              <i class="fas fa-check-circle fa-2x opacity-75"></i>
            </div>
          </div>
        </div>


        <div class="col-sm-6 col-lg-3">
          <div
            class="card shadow-sm border-0 bg-{{ 'success' if attendance_percentage >= 75 else 'warning' if attendance_percentage >= 60 else 'danger' }} text-white h-100 animate__animated animate__fadeInUp">
            <div class="card-body d-flex justify-content-between align-items-center">
              <div>
                <h6 class="text-uppercase fw-semibold mb-1">Attendance %</h6>
                <h3 class="mb-0">{{ "%.1f"|format(attendance_percentage) }}%</h3>
              </div>
              <i class="fas fa-chart-pie fa-2x opacity-75"></i>
            </div>
          </div>
        </div>


        <div class="col-sm-6 col-lg-3">
          <div class="card shadow-sm border-0 bg-info text-white h-100 animate__animated animate__fadeInUp">
            <div class="card-body d-flex justify-content-between align-items-center">
              <div>
                <h6 class="text-uppercase fw-semibold mb-1">Absent Days</h6>
                <h3 class="mb-0">{{ total_classes - present_count }}</h3>
              </div>
              <i class="fas fa-times-circle fa-2x opacity-75"></i>
            </div>
          </div>
        </div>
      </div>

      <style>
        .card {
          transition: transform 0.3s ease, box-shadow 0.3s ease;
          border-radius: 0.75rem;
        }

        .card:hover {
          transform: translateY(-4px);
          box-shadow: 0 1rem 1.5rem rgba(0, 0, 0, 0.075);
        }

        h6 {
          letter-spacing: 0.5px;
        }
      </style>

      <div class="modal fade" id="attendanceProgressHelpModal" tabindex="-1"
        aria-labelledby="attendanceProgressHelpLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable">
          <div class="modal-content border-0 shadow-sm">
            <div class="modal-header bg-primary text-white">
              <h5 class="modal-title" id="attendanceProgressHelpLabel">
                <i class="fas fa-info-circle me-2"></i> Attendance Progress Explanation
              </h5>
              <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <ul class="mb-3">
                <li><strong>Overall Attendance:</strong> Shows the percentage of classes attended out of the total.</li>
                <li><strong>Progress Bar:</strong> Uses colors to show status:
                  <ul>
                    <li><span class="text-success">Green (â‰¥ 75%)</span> = Good attendance</li>
                    <li><span class="text-warning">Yellow (60â€“74.9%)</span> = Needs improvement</li>
                    <li><span class="text-danger">Red (< 60%)</span> = Poor attendance</li>
                  </ul>
                </li>
                <li><strong>Chart:</strong> Visual breakdown of attendance over time (monthly/weekly).</li>
                <li><strong>Monthly Summary:</strong> Displays total classes, present and absent days for the current
                  period.</li>
              </ul>
              <div class="alert alert-info small">
                <i class="fas fa-lightbulb me-1"></i> Regular attendance helps improve academic performance and
                discipline.
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-outline-secondary btn-sm" data-bs-dismiss="modal">
                <i class="fas fa-times me-1"></i> Close
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="row mt-4">
        <div class="col-12">
          <div class="card shadow-sm border-0 animate__animated animate__fadeInUp">
            <div
              class="card-header bg-light d-flex align-items-center d-flex justify-content-between gap-2 p-2 flex-wrap">
              <h5 class="mb-0 text-primary d-flex align-items-center">
                <i class="fas fa-chart-line me-2"></i> Attendance Progress
              </h5>
              <button class="btn btn-sm btn-outline-info" data-bs-toggle="modal"
                data-bs-target="#attendanceProgressHelpModal">
                <i class="fas fa-circle-info me-1"></i> Instructions
              </button>
            </div>
            <div class="card-body">

              <div class="mb-4">
                <div class="d-flex justify-content-between mb-1 fw-semibold">
                  <span><i class="fas fa-calendar-check me-1 text-secondary"></i>Overall Attendance</span>
                  <span>{{ "%.1f"|format(attendance_percentage) }}%</span>
                </div>
                <div class="progress" style="height: 22px;">
                  <div class="progress-bar progress-bar-striped progress-bar-animated bg-{{
                'success' if attendance_percentage >= 75 else
                'warning' if attendance_percentage >= 60 else
                'danger'
              }}" style="width: {{ attendance_percentage }}%" role="progressbar"
                    aria-valuenow="{{ attendance_percentage }}" aria-valuemin="0" aria-valuemax="100">
                    {{ "%.1f"|format(attendance_percentage) }}%
                  </div>
                </div>
                <small class="text-muted d-block mt-2">
                  {% if attendance_percentage >= 75 %}
                  <i class="fas fa-check-circle text-success me-1"></i>Excellent attendance! Keep it up.
                  {% elif attendance_percentage >= 60 %}
                  <i class="fas fa-exclamation-triangle text-warning me-1"></i>Good, but try to improve attendance.
                  {% else %}
                  <i class="fas fa-times-circle text-danger me-1"></i>Attendance below minimum. Please improve.
                  {% endif %}
                </small>
              </div>


              <div class="row g-4">

                <div class="col-md-6">
                  <div class="bg-body-tertiary p-3 rounded shadow-sm">
                    <canvas id="attendanceChart" height="200"></canvas>
                  </div>
                </div>


                <div class="col-md-6">
                  <h6 class="text-secondary fw-semibold mb-3"><i class="fas fa-calendar-alt me-1"></i> Monthly Summary
                  </h6>
                  <ul class="list-group shadow-sm rounded">
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                      <span><i class="fas fa-user-check me-1 text-success"></i> Present Days</span>
                      <span class="badge bg-success rounded-pill">{{ present_count }}</span>
                    </li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                      <span><i class="fas fa-user-times me-1 text-danger"></i> Absent Days</span>
                      <span class="badge bg-danger rounded-pill">{{ total_classes - present_count }}</span>
                    </li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                      <span><i class="fas fa-book-open me-1 text-primary"></i> Total Classes</span>
                      <span class="badge bg-primary rounded-pill">{{ total_classes }}</span>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>


      <script>
  const ctx = document.getElementById('attendanceChart').getContext('2d');
  const attendanceChart = new Chart(ctx, {
    type: 'doughnut',
    data: {
      labels: ['Present', 'Absent'],
      datasets: [{
        data: [{{ present_count }}, {{ total_classes - present_count }}],
        backgroundColor: ['#28a745', '#dc3545'],
        borderWidth: 2,
        borderColor: '#fff'
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: {
          position: 'bottom',
          labels: {
            color: '#6c757d',
            font: {
              size: 14
            }
          }
        }
      }
    }
  });
      </script>


      <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

      <div class="modal fade" id="attendanceTableHelpModal" tabindex="-1" aria-labelledby="attendanceTableHelpLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable">
          <div class="modal-content border-0 shadow-sm">
            <div class="modal-header bg-primary text-white">
              <h5 class="modal-title" id="attendanceTableHelpLabel">
                <i class="fas fa-info-circle me-2"></i> Attendance Table Instructions
              </h5>
              <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <ul class="mb-3">
                <li><strong>Date:</strong> Shows the exact day of attendance.</li>
                <li><strong>Class/Semester:</strong> Indicates the level the student is enrolled in.</li>
                {% if institution_type == 'school' %}
                <li><strong>Stream:</strong> Visible for classes 11 and 12 only.</li>
                {% else %}
                <li><strong>Degree & Subject:</strong> Applicable for college/university level attendance tracking.</li>
                {% endif %}
                <li><strong>Status:</strong> Shows whether the student was <span class="text-success">Present</span> or
                  <span class="text-danger">Absent</span>.</li>
                <li><strong>Method:</strong> The way attendance was recorded:
                  <ul>
                    <li><i class="fas fa-qrcode text-primary"></i> QR Code</li>
                    <li><i class="fas fa-fingerprint text-primary"></i> Biometric</li>
                    <li><i class="fas fa-edit text-primary"></i> Manual entry</li>
                  </ul>
                </li>
                <li><strong>Search:</strong> Use the search bar to filter by date, subject, class, etc.</li>
              </ul>
              <div class="alert alert-info small">
                <i class="fas fa-lightbulb me-1"></i> Use this data to understand attendance behavior, identify
                irregularities, or follow up with the administration.
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-outline-secondary btn-sm" data-bs-dismiss="modal">
                <i class="fas fa-times me-1"></i> Close
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="row mt-5">
        <div class="col-12">
          <div class="card shadow-sm border-0 animate__animated animate__fadeInUp">
            <div class="card-header bg-light d-flex align-items-center">
              <h5 class="mb-0 text-primary d-flex align-items-center">
                <i class="fas fa-calendar-week me-2"></i> Attendance
              </h5>
            </div>
            <div class="card-body">
              {% if attendance_records %}

              <div class="mb-3">
                <input type="text" id="attendanceSearchInput" class="form-control form-control-sm shadow-sm"
                  placeholder="ðŸ” Search by date, class, subject, or status..." oninput="filterAttendanceRecords()">
              </div>

              <style>
                #attendanceTable thead th {
                  position: sticky;
                  top: 0;
                  background: #f8f9fa;
                  z-index: 1;
                }
              </style>

              <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                <div class="d-flex justify-content-end gap-2 p-2 flex-wrap">
                  <button id="downloadCSV" class="btn btn-sm btn-outline-primary">
                    <i class="fas fa-download me-1"></i> Download CSV
                  </button>
                  <button class="btn btn-sm btn-outline-info" data-bs-toggle="modal"
                    data-bs-target="#attendanceTableHelpModal">
                    <i class="fas fa-circle-info me-1"></i> Instructions
                  </button>
                </div>
                <script>
                  document.getElementById('downloadCSV').addEventListener('click', function () {
                    const table = document.getElementById('attendanceTable');
                    const allRows = table.querySelectorAll('thead tr, tbody tr');
                    let csv = [];

                    allRows.forEach(row => {
                      if (row.offsetParent !== null) {
                        const cols = row.querySelectorAll('th, td');
                        const rowData = [];
                        cols.forEach(col => {
                          let text = col.innerText.trim().replace(/(\r\n|\n|\r)/gm, "").replace(/"/g, '""');
                          rowData.push(`"${text}"`);
                        });
                        csv.push(rowData.join(','));
                      }
                    });

                    const csvContent = csv.join('\n');
                    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                    const url = URL.createObjectURL(blob);

                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'attendance.csv';
                    a.click();
                    URL.revokeObjectURL(url);
                  });
                </script>

                <table class="table table-hover align-middle mb-0" id="attendanceTable">
                  <thead class="table-light">
                    <tr>
                      <th scope="col"><i class="fas fa-calendar-alt me-1"></i> Date</th>
                      <th scope="col"><i class="fas fa-school me-1"></i> Class/Semester</th>

                      {% if institution_type == 'school' %}
                      {% if student.class_name.startswith('11') or student.class_name.startswith('12') %}
                      <th scope="col"><i class="fas fa-stream me-1"></i> Stream</th>
                      {% endif %}
                      {% else %}
                      <th scope="col"><i class="fas fa-graduation-cap me-1"></i> Degree</th>
                      <th scope="col"><i class="fas fa-book-open me-1"></i> Subject</th>
                      {% endif %}

                      <th scope="col"><i class="fas fa-user-check me-1"></i> Status</th>
                      <th scope="col"><i class="fas fa-fingerprint me-1"></i> Method</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for record in attendance_records %}
                    <tr>
                      <td>{{ record.date.strftime('%Y-%m-%d') }}</td>
                      <td>
                        {% if institution_type == 'school' %}
                        {{ student.class_name }}
                        {% else %}
                        {{ record.class_name }}
                        {% endif %}
                      </td>

                      {% if institution_type == 'school' and (student.class_name.startswith('11') or
                      student.class_name.startswith('12')) %}
                      <td>{{ student.stream_or_semester or '-' }}</td>
                      {% elif institution_type != 'school' %}
                      <td>{{ record.degree or '-' }}</td>
                      <td>{{ record.subject }}</td>
                      {% endif %}

                      <td>
                        <span class="badge bg-{{ 'success' if record.status == 'Present' else 'danger' }}">
                          <i class="fas fa-{{ 'check' if record.status == 'Present' else 'times' }} me-1"></i>
                          {{ record.status }}
                        </span>
                      </td>

                      <td>
                        <span class="badge bg-secondary">
                          {% if record.method == 'QR' %}
                          <i class="fas fa-qrcode me-1"></i>QR Code
                          {% elif record.method == 'Biometric' %}
                          <i class="fas fa-fingerprint me-1"></i>Biometric
                          {% else %}
                          <i class="fas fa-edit me-1"></i>Manual
                          {% endif %}
                        </span>
                      </td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>

              {% else %}

              <div class="text-center py-5">
                <i class="fas fa-calendar-times fa-3x text-muted mb-3"></i>
                <p class="text-muted fs-6">No attendance records available for the last 7 days.</p>
              </div>
              {% endif %}
            </div>
          </div>
        </div>
      </div>


      <script>
        function filterAttendanceRecords() {
          const input = document.getElementById('attendanceSearchInput').value.toLowerCase().trim();
          const rows = document.querySelectorAll('#attendanceTable tbody tr');

          rows.forEach(row => {
            const rowText = row.innerText.toLowerCase();
            row.style.display = rowText.includes(input) ? '' : 'none';
          });
        }
      </script>

      <div class="modal fade" id="parentContactHelpModal" tabindex="-1" aria-labelledby="parentContactHelpLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable">
          <div class="modal-content border-0 shadow-sm">
            <div class="modal-header bg-info text-white">
              <h5 class="modal-title" id="parentContactHelpLabel">
                <i class="fas fa-info-circle me-2"></i> Parent / Guardian Contact Help
              </h5>
              <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <ul class="mb-3">
                <li><strong>Parent Name:</strong> The name of the person responsible for the student.</li>
                <li><strong>Phone Number:</strong> This number is used to send:
                  <ul>
                    <li><i class="fas fa-sms text-success me-1"></i> SMS alerts for absences</li>
                    <li><i class="fas fa-bell text-warning me-1"></i> Urgent school updates</li>
                  </ul>
                </li>
                <li><strong>Email:</strong> Used to send:
                  <ul>
                    <li><i class="fas fa-envelope text-primary me-1"></i> Monthly attendance reports</li>
                    <li><i class="fas fa-info-circle text-secondary me-1"></i> School circulars and important
                      announcements</li>
                  </ul>
                </li>
                <li><strong>Why this matters:</strong> Without contact info, you may miss critical alerts about your
                  child's attendance or academic updates.</li>
              </ul>
              <div class="alert alert-info small">
                <i class="fas fa-lightbulb me-1"></i> Make sure the contact details are correct and kept up to date.
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-outline-secondary btn-sm" data-bs-dismiss="modal">
                <i class="fas fa-times me-1"></i> Close
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="row mt-5">
        <div class="col-12">
          <div class="card shadow-sm border-0 animate__animated animate__fadeInUp">
            <div
              class="card-header bg-light d-flex align-items-center d-flex justify-content-between gap-2 p-2 flex-wrap">
              <h5 class="mb-0 text-secondary d-flex align-items-center">
                <i class="fas fa-user-friends me-2 text-primary"></i> Parent / Guardian Contact
              </h5>
              <button class="btn btn-sm btn-outline-info ms-3" data-bs-toggle="modal"
                data-bs-target="#parentContactHelpModal">
                <i class="fas fa-circle-info me-1"></i> Help
              </button>

            </div>
            <div class="card-body">
              {% if parent_contact %}
              <div class="row g-4 mb-4">
                <div class="col-md-4">
                  <div class="d-flex align-items-center">
                    <i class="fas fa-user me-2 text-info"></i>
                    <strong>Parent Name:</strong>&nbsp; {{ parent_contact.parent_name }}
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="d-flex align-items-center">
                    <i class="fas fa-phone-alt me-2 text-success"></i>
                    <strong>Phone:</strong>&nbsp; {{ parent_contact.phone or 'Not provided' }}
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="d-flex align-items-center">
                    <i class="fas fa-envelope me-2 text-warning"></i>
                    <strong>Email:</strong>&nbsp; {{ parent_contact.email or 'Not provided' }}
                  </div>
                </div>
              </div>
              <a href="{{ url_for('parent_contact') }}"
                class="btn btn-outline-primary d-inline-flex align-items-center">
                <i class="fas fa-pen me-2"></i> Update Contact Info
              </a>
              {% else %}
              <div
                class="alert alert-warning d-flex align-items-center justify-content-between flex-wrap gap-2 shadow-sm">
                <div class="d-flex align-items-center">
                  <i class="fas fa-exclamation-circle me-2 fs-5 text-warning"></i>
                  <span>
                    Parent contact information is missing. This is required to receive important attendance
                    notifications.
                  </span>
                </div>
                <a href="{{ url_for('parent_contact') }}"
                  class="btn btn-warning btn-sm d-inline-flex align-items-center">
                  <i class="fas fa-plus-circle me-1"></i> Add Contact Info
                </a>
              </div>
              {% endif %}
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

{% endblock %}